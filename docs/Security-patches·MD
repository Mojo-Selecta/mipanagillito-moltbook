# ğŸ›¡ï¸ GILLITO SECURITY â€” REMAINING PATCHES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GuÃ­a de integraciÃ³n para lo que falta.
# Copia y pega exactamente donde se indica.

## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
## 1. BUDGET PERSISTENCE (CRÃTICO)
## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# PROBLEMA: .gillito-mention-budget.json se borra cada GitHub Actions run.
# La protecciÃ³n anti-spam es inÃºtil sin esto.

# SOLUCIÃ“N: AÃ±adir estos 2 steps a CADA workflow de reply.
# (reply-x.yml, reply.yml, interact.yml)

# â”€â”€â”€â”€â”€â”€ COPIAR ESTOS 2 STEPS â”€â”€â”€â”€â”€â”€
# Poner ANTES del step "Run Script":

#      - name: ğŸ›¡ï¸ Restore security budget
#        uses: actions/cache@v4
#        with:
#          path: .gillito-mention-budget.json
#          key: gillito-mention-budget-${{ github.run_id }}
#          restore-keys: |
#            gillito-mention-budget-

# Poner DESPUÃ‰S del step "Run Script":

#      - name: ğŸ›¡ï¸ Save security budget
#        if: always()
#        uses: actions/cache/save@v4
#        with:
#          path: .gillito-mention-budget.json
#          key: gillito-mention-budget-${{ github.run_id }}

# â”€â”€â”€â”€â”€â”€ EJEMPLO COMPLETO â”€â”€â”€â”€â”€â”€
# AsÃ­ queda un workflow de reply con budget persistence:
#
# jobs:
#   reply:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#
#       - name: ğŸ›¡ï¸ Restore security budget
#         uses: actions/cache@v4
#         with:
#           path: .gillito-mention-budget.json
#           key: gillito-mention-budget-${{ github.run_id }}
#           restore-keys: |
#             gillito-mention-budget-
#
#       - name: Reply to mentions
#         run: node scripts/reply-x.js
#         env:
#           GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
#           OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
#           # ... rest of your env vars
#
#       - name: ğŸ›¡ï¸ Save security budget
#         if: always()
#         uses: actions/cache/save@v4
#         with:
#           path: .gillito-mention-budget.json
#           key: gillito-mention-budget-${{ github.run_id }}


## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
## 2. OUTPUT VALIDATION â€” POSTING SCRIPTS
## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Estos scripts generan contenido ORIGINAL y lo publican.
# Necesitan sec.processOutput() ANTES de publicar.

# â”€â”€â”€â”€â”€â”€ post-to-x.js â”€â”€â”€â”€â”€â”€
# Buscar la lÃ­nea donde se postea (algo como):
#   const result = await C.xPost(tweet);
# 
# Cambiar a:
#   const outputCheck = C.sec.processOutput(tweet);
#   if (!outputCheck.safe) {
#     C.log.warn(`ğŸ›¡ï¸ Post bloqueado: ${outputCheck.blocked.join(', ')}`);
#     return;
#   }
#   const result = await C.xPost(outputCheck.text);

# â”€â”€â”€â”€â”€â”€ post-to-moltbook.js (hourly) â”€â”€â”€â”€â”€â”€
# Buscar la lÃ­nea donde se postea (algo como):
#   await C.moltPost(submolt, title, content);
# 
# Cambiar a:
#   const outputCheck = C.sec.processOutput(content);
#   if (!outputCheck.safe) {
#     C.log.warn(`ğŸ›¡ï¸ Post Moltbook bloqueado: ${outputCheck.blocked.join(', ')}`);
#     return;
#   }
#   const titleCheck = C.sec.processOutput(title);
#   await C.moltPost(submolt, titleCheck.text || title, outputCheck.text);

# â”€â”€â”€â”€â”€â”€ god-mode.js (website generator) â”€â”€â”€â”€â”€â”€
# Buscar la lÃ­nea donde se deploya HTML:
#   await C.cfDeploy(html, projectName);
# 
# Cambiar a:
#   const htmlCheck = C.sec.processOutput(html);
#   if (!htmlCheck.safe) {
#     C.log.warn(`ğŸ›¡ï¸ HTML bloqueado â€” secrets detectados: ${htmlCheck.blocked.join(', ')}`);
#     C.log.warn('âš ï¸ NO se deployÃ³ â€” revisar output del LLM');
#     return;
#   }
#   await C.cfDeploy(htmlCheck.text, projectName);


## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
## 3. SECURITY TEST WORKFLOW
## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Archivo: .github/workflows/security-test.yml
# Ya incluido como archivo separado (security-test.yml)
# Solo sÃºbelo al repo.
# Se activa automÃ¡ticamente en cada push a scripts/


## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
## 4. GITHUB SECURITY SETTINGS (30 seg)
## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ve a tu repo â†’ Settings â†’ Code security and analysis

# ACTIVAR:
# âœ… Dependabot alerts â€” te avisa de vulnerabilidades en npm packages
# âœ… Code scanning â€” detecta problemas de seguridad en tu cÃ³digo
# âœ… Secret scanning push protection â€” bloquea pushes con API keys

# Ya tienes habilitado:
# âœ… Security advisories
# âœ… Secret scanning alerts


## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
## 5. ARCHIVOS A SUBIR AL REPO
## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Desde sesiones anteriores (ya los tienes):
#   lib/security.js          â† mÃ³dulo de seguridad (618 lÃ­neas)
#   scripts/reply-x.js       â† reply X con security pipeline
#   scripts/reply.js          â† reply Moltbook con security pipeline  
#   scripts/interact.js       â† interact con security pipeline
#   lib/core.js               â† core con DEFENSIVE_PROMPT + sec export
#   .gitignore                â† actualizado con .gillito-*.json

# Nuevos de esta sesiÃ³n:
#   scripts/test-security.js  â† test suite (este archivo)
#   .github/workflows/security-test.yml â† CI para tests

# Parches manuales (tÃº aplicas):
#   scripts/post-to-x.js     â† aÃ±adir processOutput (3 lÃ­neas)
#   scripts/god-mode.js       â† aÃ±adir processOutput antes de cfDeploy (5 lÃ­neas)
#   scripts/post-to-moltbook.js â† aÃ±adir processOutput (4 lÃ­neas)
#   .github/workflows/reply-x.yml â† aÃ±adir cache steps (12 lÃ­neas)
#   .github/workflows/reply.yml   â† aÃ±adir cache steps (12 lÃ­neas)
#   .github/workflows/interact.yml â† aÃ±adir cache steps (12 lÃ­neas)


## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
## RESUMEN DE PROTECCIÃ“N
## â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Vector de Ataque         â”‚ ProtecciÃ³n            â”‚ Estado     â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ Prompt injection         â”‚ detectInjection()     â”‚ âœ… LISTO   â”‚
# â”‚ Contenido malicioso      â”‚ sanitizeInput()       â”‚ âœ… LISTO   â”‚
# â”‚ Spam de menciones        â”‚ checkMentionBudget()  â”‚ âœ… LISTO   â”‚
# â”‚ Budget persistence       â”‚ actions/cache         â”‚ â¬œ PENDIENTEâ”‚
# â”‚ Output leak (replies)    â”‚ processOutput()       â”‚ âœ… LISTO   â”‚
# â”‚ Output leak (posts)      â”‚ processOutput()       â”‚ â¬œ PENDIENTEâ”‚
# â”‚ Output leak (god-mode)   â”‚ processOutput()       â”‚ â¬œ PENDIENTEâ”‚
# â”‚ Secret en logs           â”‚ redactSecrets()       â”‚ âœ… LISTO   â”‚
# â”‚ Defensive prompt         â”‚ DEFENSIVE_PROMPT      â”‚ âœ… LISTO   â”‚
# â”‚ .gitignore               â”‚ .gillito-*.json       â”‚ âœ… LISTO   â”‚
# â”‚ Automated tests          â”‚ test-security.js      â”‚ âœ… LISTO   â”‚
# â”‚ CI/CD testing            â”‚ security-test.yml     â”‚ âœ… LISTO   â”‚
# â”‚ Dependabot               â”‚ GitHub settings       â”‚ â¬œ PENDIENTEâ”‚
# â”‚ Code scanning            â”‚ GitHub settings       â”‚ â¬œ PENDIENTEâ”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
